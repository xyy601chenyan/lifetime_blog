<div class="col-md-12">
  <div class="group">
    <%= link_to("新增文章",new_article_path,class: "btn btn-danger pull-right") %>
  </div>
  <%= form_tag bulk_operate_articles_path, class: "form-inline" do %>
<table class="table table-hover">
  <thead>
    <tr>
      <th><%= check_box_tag "全选","1",false,id: "toggle_all" %></td>
      <th>#</th>
      <th>标题</th>
      <th>正文</th>
      <th>创建时间</th>
    </tr>
  </thead>
  <tbody class="sortable">
    <% @articles.each do |article| %>
      <tr data-reorder-url="<%= reorder_article_path(article.token) %>">
        <td><%= check_box_tag "ids[]",article.token %></td>
        <td>#</td>
        <td>
          <span class="sortable_icon">☰</span>
          <%= link_to(article.title,article_path(article.token))%>
        </td>
        <td><%= article.description%></td>
        <td><%= article.created_at%></td>
        <td>
          <%= link_to("上移",reorder_article_path(article.token,:position => :up),method: :post,class: "btn btn-default") %>
          <%= link_to("下移",reorder_article_path(article.token,:position => :down),method: :post,class: "btn btn-default") %>
          <%= link_to("置顶",reorder_article_path(article.token,position: :first),method: :post,class: "btn btn-default") %>
          <%= link_to("置底",reorder_article_path(article.token,position: :last),method: :post,class: "btn btn-default") %>
          <%= link_to("编辑",edit_article_path(article.token),class: "btn btn-sm btn-default")%>
          <%= link_to("删除",article_path(article.token),class: "btn btn-sm btn-default",method: :delete,data: {confirm: "确定要删除该篇文章吗?"})%>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<p>
<!-- 这三个select_tag和submit_tag后续将使用i18n和zh-CN语系模板转成中文，使代码保持DRY-->
<%= select_tag :status,options_for_select(Article::STATUS.map {|s| (s)},class: "form-control")%>
<%= submit_tag "bulk_update",class: "btn btn-primary",data: {confirm: "确定批次更新文章？"}%>
<%= submit_tag "bulk_delete",class: "btn btn-danger",data: {confirm: "确定批次删除文章？"}%>
</p>
<% end %>
</div>

<script>
$("#toggle_all").click(function(){
  if ($(this).prop("checked")){
    $("input[name='ids[]']").prop("checked",true);
  }
  else
  {
    $("input[name='ids[]']").prop("checked",false);
  }
});

$(".sortable").sortable({
  axis: 'y',
  items: 'tr',
  cursor: 'move',
  //handle: ".sortable_icon',//限定只有放在☰图标上才能拖动
  stop: function(e,ui){
    ui.item.children('td').effect('highlight',{},1000)
  },
  update: function(e,ui){
    reorder_url = ui.item.data('reorder-url')
    position = ui.item.index()
    $.ajax({
      type: 'POST',
      url: reorder_url,
      dataType: 'json',
      data: {position: position}
    })
  }
});
</script>
